<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Simulador de Geladeira</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }

        .painel {
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2);
            max-width: 800px;
            margin: 20px auto;
        }

        button {
            margin: 5px;
        }

        .status {
            margin-top: 20px;
            font-size: 1.1em;
            line-height: 1.5;
        }

        .ativo {
            color: green;
            font-weight: bold;
        }

        .inativo {
            color: gray;
        }

        canvas {
            margin-top: 30px;
        }
    </style>
</head>

<body>
    <div class="painel">
        <button onclick="iniciarSimulacao()">Iniciar Nova Simulação</button>
        <div id="simulacoes"></div>
    </div>

    <script>
        class SimuladorGeladeira {
            constructor(id) {
                this.id = id;
                this.tempAmbiente = 25; // Temperatura ambiente inicial
                this.tempFreezer = this.tempAmbiente;
                this.tempResistencia = this.tempAmbiente;
                this.tempEvaporador = this.tempAmbiente;
                this.tempMotor = this.tempAmbiente;

                // Relé Térmico
                this.releTermicoAtutou = 0;
                this.releTermicoAcionado = false;
                this.tempReleTermico = 100;

                // Estado dos componentes
                this.compressorLigado = false;
                this.resistenciaLigada = false;
                this.portaFreezerAberta = false;
                this.portaGeladeiraAberta = false;

                this.ventoinhaCompressor = false;
                this.ventoinhaFreezer = false;
                this.luzFreezer = false;
                this.luzGeladeira = false;

                this.fatorVelocidade = 1; // Fator de velocidade da simulação
                this.tempoCompressorLigado = 0; // Contador de tempo de funcionamento do compressor

                // Cria um contêiner para a simulação
                this.container = document.createElement('div');
                this.container.classList.add('painel');
                document.getElementById('simulacoes').appendChild(this.container);

                this.container.innerHTML = `
                    <button id="pauseButton${this.id}">Pausar</button>
                    <button id="toggleCompressor${this.id}">Toggle Compressor</button>
                    <button id="togglePortaFreezer${this.id}">Toggle Porta Freezer</button>
                    <button id="togglePortaGeladeira${this.id}">Toggle Porta Geladeira</button>
                    <button id="toggleResistencia${this.id}">Toggle Resistência</button>
                    <button id="toggleVentoinhaCompressor${this.id}">Toggle Ventoinha Compressor</button>
                    <button id="toggleVentoinhaFreezer${this.id}">Toggle Ventoinha Freezer</button>
                    <label for="velocidade">Velocidade da simulação: <span id="velocidadeValor${this.id}">1x</span></label>
                    <input type="range" id="velocidade${this.id}" min="1" max="60" step="1" value="1">
                    <div class="status" id="status${this.id}"></div>
                    <canvas id="graficoTemperaturas${this.id}" width="700" height="300"></canvas>
                `;

                // Inicializa o gráfico
                this.grafico = new Chart(this.container.querySelector(`#graficoTemperaturas${this.id}`).getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            { label: 'Ambiente', borderColor: 'orange', data: [] },
                            { label: 'Freezer', borderColor: 'blue', data: [] },
                            { label: 'Evaporador', borderColor: 'cyan', data: [] },
                            { label: 'Resistência', borderColor: 'red', data: [] },
                            { label: 'Motor Compressor', borderColor: 'green', data: [] }
                        ]
                    },
                    options: {
                        responsive: true,
                        animation: false,
                        scales: {
                            y: { title: { display: true, text: 'Temperatura (°C)' } },
                            x: { title: { display: true, text: 'Tempo (s)' } }
                        },
                        plugins: {
                            legend: { display: true, position: 'top' },
                            title: { display: true, text: 'Simulador de Geladeira' }
                        }
                    }
                });

                // Associa as funções de controle com os respectivos eventos
                this.setupEventListeners();

                // Inicia a atualização da simulação
                this.atualizar();
            }

            // Função que inicia o loop de atualização
            atualizar() {
                setInterval(() => {
                    this.atualizarSimulacao(1); // Passando 1 como dt para o tempo
                }, 1000 / this.fatorVelocidade); // Ajusta o intervalo de atualização com base na velocidade
            }

            // Atualiza a simulação
            atualizarSimulacao(dt) {
                // Relé térmico
                if (this.tempMotor >= this.tempReleTermico && !this.releTermicoAcionado) {
                    this.releTermicoAcionado = true;
                    this.releTermicoAtutou++;
                    this.compressorLigado = false;
                    this.tempMotor = this.tempReleTermico + 10;
                } else if (this.releTermicoAcionado && this.tempMotor < 70) {
                    this.releTermicoAcionado = false;
                    this.compressorLigado = true;
                }

                // Atualizar as temperaturas com base nos componentes
                if (this.compressorLigado && !this.portaFreezerAberta) {
                    this.tempFreezer -= 0.1; // Resfriamento do freezer
                } else if (this.portaFreezerAberta) {
                    this.tempFreezer += 0.1; // Aumento da temperatura se a porta estiver aberta
                }

                if (this.resistenciaLigada) {
                    this.tempResistencia += 0.05; // Aquece a resistência
                } else {
                    this.tempResistencia -= 0.05; // Resfriamento da resistência
                }

                if (this.compressorLigado) {
                    this.tempEvaporador -= 0.1; // Resfriamento do evaporador
                }

                // Atualiza o gráfico com os dados das temperaturas
                this.atualizarGrafico();

                // Atualiza a interface de status
                this.atualizarInterface();
            }

            // Atualiza o gráfico
            atualizarGrafico() {
                const grafico = this.grafico;
                const tempo = grafico.data.labels.length;

                grafico.data.labels.push(tempo);
                grafico.data.datasets[0].data.push(this.tempAmbiente);
                grafico.data.datasets[1].data.push(this.tempFreezer);
                grafico.data.datasets[2].data.push(this.tempEvaporador);
                grafico.data.datasets[3].data.push(this.tempResistencia);
                grafico.data.datasets[4].data.push(this.tempMotor);

                if (grafico.data.labels.length > 300) {
                    grafico.data.labels.shift();
                    grafico.data.datasets.forEach(dataset => dataset.data.shift());
                }

                grafico.update();
            }

            // Atualiza a interface de status
            atualizarInterface() {
                document.getElementById(`status${this.id}`).innerHTML = `
                    <strong>Temperaturas:</strong><br>
                    - Ambiente: ${this.tempAmbiente.toFixed(2)}°C<br>
                    - Freezer: ${this.tempFreezer.toFixed(2)}°C<br>
                    - Evaporador: ${this.tempEvaporador.toFixed(2)}°C<br>
                    - Resistência: ${this.tempResistencia.toFixed(2)}°C<br>
                    - Motor Compressor: ${this.tempMotor.toFixed(2)}°C<br><br>

                    <strong>Componentes:</strong><br>
                    - Porta do Freezer: ${this.portaFreezerAberta ? 'Aberta' : 'Fechada'}<br>
                    - Porta da Geladeira: ${this.portaGeladeiraAberta ? 'Aberta' : 'Fechada'}<br>
                    - Compressor: ${this.compressorLigado ? 'Ligado' : 'Desligado'}<br>
                    - Resistência: ${this.resistenciaLigada ? 'Ligada' : 'Desligada'}<br>
                    - Ventoinha do Compressor: ${this.ventoinhaCompressor ? 'Ligada' : 'Desligada'}<br>
                    - Ventoinha do Freezer: ${this.ventoinhaFreezer ? 'Ligada' : 'Desligada'}<br>
                    - Rele Térmico: ${this.releTermicoAcionado ? 'Acionado' : 'Desligado'}<br>
                    - Rele Termico Atutou: ${this.releTermicoAtutou}<br>
                `;
            }

            // Associa os listeners de eventos aos botões
            setupEventListeners() {
                document.getElementById(`pauseButton${this.id}`).addEventListener('click', () => this.togglePause());
                document.getElementById(`toggleCompressor${this.id}`).addEventListener('click', () => this.toggleCompressor());
                document.getElementById(`togglePortaFreezer${this.id}`).addEventListener('click', () => this.togglePortaFreezer());
                document.getElementById(`togglePortaGeladeira${this.id}`).addEventListener('click', () => this.togglePortaGeladeira());
                document.getElementById(`toggleResistencia${this.id}`).addEventListener('click', () => this.toggleResistencia());
                document.getElementById(`toggleVentoinhaCompressor${this.id}`).addEventListener('click', () => this.toggleVentoinhaCompressor());
                document.getElementById(`toggleVentoinhaFreezer${this.id}`).addEventListener('click', () => this.toggleVentoinhaFreezer());
                document.getElementById(`velocidade${this.id}`).addEventListener('input', (e) => this.atualizarVelocidade(e.target.value));
            }

            // Funções de controle
            toggleCompressor() {
                this.compressorLigado = !this.compressorLigado;
            }

            togglePortaFreezer() {
                this.portaFreezerAberta = !this.portaFreezerAberta;
            }

            togglePortaGeladeira() {
                this.portaGeladeiraAberta = !this.portaGeladeiraAberta;
            }

            toggleResistencia() {
                this.resistenciaLigada = !this.resistenciaLigada;
            }

            toggleVentoinhaCompressor() {
                this.ventoinhaCompressor = !this.ventoinhaCompressor;
            }

            toggleVentoinhaFreezer() {
                this.ventoinhaFreezer = !this.ventoinhaFreezer;
            }

            atualizarVelocidade(valor) {
                this.fatorVelocidade = parseFloat(valor);
                document.getElementById(`velocidadeValor${this.id}`).innerText = valor + "x";
            }
        }

        let simuladores = [];

        // Função para iniciar uma nova simulação
        function iniciarSimulacao() {
            const simulador = new SimuladorGeladeira(simuladores.length);
            simuladores.push(simulador);
        }
    </script>
</body>

</html>
